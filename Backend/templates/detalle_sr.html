{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Detalle SR</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
</head>

<body>

<!-- TOPBAR -->
<div class="topbar">
    <h5>Sistema de OT</h5>
    <div class="user">
        {{ request.user }} |
        <a href="/logout/" class="text-white text-decoration-none ms-2">Cerrar sesi√≥n</a>
    </div>
</div>

<div class="container-fluid px-5 mt-4">

    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2>Detalle de SR</h2>
            <p class="text-muted mb-0">
                Informaci√≥n completa de la orden de trabajo
            </p>
        </div>

        <a href="/ver-sr/" class="btn btn-outline-secondary">
            ‚Üê Regresar
        </a>
    </div>

    <!-- CARD PRINCIPAL -->
    <div class="card-section">

        <!-- CABECERA OT -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h4 class="mb-0">OT {{ ot.ot }}</h4>

            <div>
                {% if ot.estado == "abierto" %}
                    <span class="badge badge-yellow">Abierto</span>
                {% else %}
                    <span class="badge badge-green">Cerrado</span>
                {% endif %}
            </div>
        </div>

        <!-- GRID INFO -->
        <div class="row g-4">

            <div class="col-md-4">
                <small class="text-muted">Cliente</small>
                <div class="fw-semibold">{{ ot.cliente }}</div>
            </div>

            <div class="col-md-4">
                <small class="text-muted">Segmento</small>
                <div class="fw-semibold">{{ ot.segmento }}</div>
            </div>

            <div class="col-md-4">
                <small class="text-muted">Familia</small>
                <div class="fw-semibold">{{ ot.familia }}</div>
            </div>

            <div class="col-md-4">
                <small class="text-muted">Producto</small>
                <div class="fw-semibold">{{ ot.producto }}</div>
            </div>

            <div class="col-md-4">
                <small class="text-muted">Producto hijo</small>
                <div class="fw-semibold">{{ ot.producto_hijo }}</div>
            </div>

            <div class="col-md-4">
                <small class="text-muted">Comercial</small>
                <div class="fw-semibold">{{ ot.comercial }}</div>
            </div>

            <div class="col-md-4">
                <small class="text-muted">SOL</small>
                <div class="fw-semibold">{{ ot.sol }}</div>
            </div>

            <div class="col-md-4">
                <small class="text-muted">Enlace</small>
                <div class="fw-semibold">{{ ot.enlace_id }}</div>
            </div>

            <div class="col-md-4">
                <small class="text-muted">Fecha ingreso</small>
                <div class="fw-semibold">{{ ot.fecha_ingreso|date:"d/m/Y" }}</div>
            </div>

            <div class="col-md-4">
                <small class="text-muted">D√≠as de cola</small>
                <div class="mt-1">
                    {% if ot.color_cola == "green" %}
                        <span class="badge badge-green">{{ ot.dias_cola }}</span>
                    {% elif ot.color_cola == "yellow" %}
                        <span class="badge badge-yellow">{{ ot.dias_cola }}</span>
                    {% else %}
                        <span class="badge badge-red">{{ ot.dias_cola }}</span>
                    {% endif %}
                </div>
            </div>

        </div>
    </div>

    <!-- COMENTARIOS -->
    <div class="card mt-4">
        <div class="card-header">
            Comentarios
        </div>

        <div class="card-body">

            <!-- Formulario agregar comentario -->
            <form method="POST" class="mb-4">
                {% csrf_token %}
                <textarea
                    name="comentario"
                    class="form-control mb-2"
                    rows="3"
                    placeholder="Escribe un comentario..."></textarea>

                <button class="btn btn-primary">
                    Agregar comentario
                </button>
            </form>

            <!-- Lista de comentarios -->
            {% for comentario in comentarios %}
                <div class="border rounded p-3 mb-3 bg-light">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <p class="mb-1">{{ comentario.texto }}</p>
                            <small class="text-muted">
                                {{ comentario.usuario }} ‚Äî {{ comentario.fecha|date:"d/m/Y H:i" }}
                            </small>
                        </div>

                        {% if comentario.usuario == request.user %}
                            <form method="POST"
                                action="{% url 'borrar_comentario' comentario.id %}">
                                {% csrf_token %}
                                <button
                                    class="btn btn-sm btn-outline-danger"
                                    title="Eliminar comentario">
                                    üóëÔ∏è
                                </button>
                            </form>
                        {% endif %}
                    </div>
                </div>
            {% empty %}
                <p class="text-muted">No hay comentarios a√∫n.</p>
            {% endfor %}

        </div>
    </div>
</div>

</body>
</html>
